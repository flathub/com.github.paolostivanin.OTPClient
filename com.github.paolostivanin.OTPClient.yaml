app-id: com.github.paolostivanin.OTPClient
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: otpclient
finish-args:
- "--share=ipc"
- "--socket=fallback-x11"
- "--socket=wayland"
- "--device=all"
- "--talk-name=org.freedesktop.secrets"
- "--talk-name=org.gtk.vfs.*"
- "--filesystem=xdg-run/gvfsd"
cleanup:
- /include
- /lib/cmake
- /lib/pkgconfig"
- "*.la"
- "*.a"
- /share/doc
- /share/man
modules:
- name: jansson
  cleanup:
  - "/bin"
  - "/share"
  sources:
  - type: archive
    url: https://github.com/akheron/jansson/releases/download/v2.15.0/jansson-2.15.0.tar.gz
    sha256: 070a629590723228dc3b744ae90e965a569efb9c535b3309b52e80e75d8eb3be

- name: protobuf
  buildsystem: cmake-ninja
  config-opts:
  - "-DCMAKE_BUILD_TYPE=Release"
  - "-Dprotobuf_BUILD_TESTS=OFF"
  - "-Dprotobuf_ABSL_PROVIDER=package"
  cleanup:
  - "/bin"
  - "/share"
  sources:
  - type: archive
    url: https://github.com/protocolbuffers/protobuf/releases/download/v25.8/protobuf-25.8.tar.gz
    sha256: 15a034460107cf403338c34fa4e07df8ab4fda7ee2785bea83854d6fdd705c90

- name: protobuf-c
  cleanup:
  - "/bin"
  - "/share"
  sources:
  - type: archive
    url: https://github.com/protobuf-c/protobuf-c/archive/refs/tags/v1.5.2.tar.gz
    sha256: cea46eeaa19c52924938b582c5d128a6ed3b6fb5b3f4677476a1781cc06e03f3

- name: qrencode
  buildsystem: cmake-ninja
  config-opts:
  - "-DCMAKE_BUILD_TYPE=Release"
  - "-DBUILD_SHARED_LIBS=TRUE"
  sources:
  - type: archive
    url: https://github.com/fukuchi/libqrencode/archive/refs/tags/v4.1.1.tar.gz
    sha256: 5385bc1b8c2f20f3b91d258bf8ccc8cf62023935df2d2676b5b67049f31a049c
  - type: patch
    path: cmake-minimum-3.12.patch

- name: zbar
  config-opts:
  - "--without-qt"
  - "--without-qt5"
  - "--without-gtk"
  - "--without-xv"
  - "--without-imagemagick"
  - "--without-dbus"
  - "--with-python=python3"
  - "--disable-doc"
  - "--enable-codes=qrcode"
  sources:
  - type: archive
    url: https://www.linuxtv.org/downloads/zbar/zbar-0.23.93.tar.gz
    sha256: 78ae427a529f0399561bc198de5c2c7ca3f11d05fa9e903e65e501168433d218

- name: libcotp
  buildsystem: cmake-ninja
  config-opts:
  - "-DCMAKE_BUILD_TYPE=Release"
  - "-DCMAKE_INSTALL_LIBDIR=lib"
  sources:
  - type: archive
    url: https://github.com/paolostivanin/libcotp/archive/v3.1.1.tar.gz
    sha256: 9b5778b8e38d9b0c33d6331ec980094b0035bf53e6064bbcc2ed988b0d4b3d13

- name: OTPClient
  buildsystem: cmake-ninja
  config-opts:
  - "-DCMAKE_BUILD_TYPE=Release"
  - "-DIS_FLATPAK=ON"
  sources:
  - type: archive
    url: https://github.com/paolostivanin/otpclient/archive/v4.3.1.tar.gz
    sha256: 35c4999d6b23ad4e58e84e34dc007d98d483c0edfe937f3a21132b3ae24adf4a
